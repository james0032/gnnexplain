# Pipeline Flow Diagram

**Visual guide to the complete GNN Explainer pipeline**

---

## ğŸ”„ **Complete Pipeline Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        INPUT DATA (01_raw/)                         â”‚
â”‚                                                                     â”‚
â”‚  robo_train.txt     robo_val.txt     robo_test.txt                â”‚
â”‚  node_dict          rel_dict                                       â”‚
â”‚                                                                     â”‚
â”‚  Format: head \t relation \t tail                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PIPELINE 1: DATA PREPARATION                           â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Load Triples â”‚â†’â”‚Build Dicts   â”‚â†’â”‚Create PyG    â”‚            â”‚
â”‚  â”‚ From Files   â”‚  â”‚Entity/Rel    â”‚  â”‚Data Object   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                            â†“                        â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                  â”‚Generate Negative â”‚              â”‚
â”‚                                  â”‚Samples           â”‚              â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTERMEDIATE DATA (02_intermediate/)             â”‚
â”‚                                                                     â”‚
â”‚  knowledge_graph.pkl    pyg_data.pkl    negative_samples.pkl      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PIPELINE 2: TRAINING                                   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                  CompGCN ENCODER                         â”‚     â”‚
â”‚  â”‚                                                           â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚     â”‚
â”‚  â”‚  â”‚Layer 1 â”‚ â†’ â”‚Layer 2 â”‚ â†’ â”‚Layer N â”‚                â”‚     â”‚
â”‚  â”‚  â”‚CompGCN â”‚    â”‚CompGCN â”‚    â”‚CompGCN â”‚                â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚     â”‚
â”‚  â”‚       â†“             â†“             â†“                      â”‚     â”‚
â”‚  â”‚  [Node Embeddings] + [Relation Embeddings]              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚           DECODER (Choose one)                           â”‚     â”‚
â”‚  â”‚                                                           â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚
â”‚  â”‚  â”‚DistMult â”‚  â”‚ ComplEx â”‚  â”‚ RotatE  â”‚  â”‚ ConvE   â”‚   â”‚     â”‚
â”‚  â”‚  â”‚(Bilinearâ”‚  â”‚(Complex â”‚  â”‚(Rotationâ”‚  â”‚(Conv2D  â”‚   â”‚     â”‚
â”‚  â”‚  â”‚ scoring)â”‚  â”‚ space)  â”‚  â”‚ based)  â”‚  â”‚ based)  â”‚   â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚
â”‚  â”‚       â†“             â†“             â†“             â†“       â”‚     â”‚
â”‚  â”‚              [Link Prediction Scores]                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â†“                                         â”‚
â”‚  Training Loss â†’ Backprop â†’ Update Weights                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TRAINED MODEL (06_models/)                       â”‚
â”‚                                                                     â”‚
â”‚  trained_model.pkl  (CompGCN Encoder + Decoder)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PIPELINE 3: EXPLANATION                                â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Step 1: Select Triples to Explain                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”‚Random  â”‚  â”‚Specific       â”‚  â”‚Specific Nodesâ”‚        â”‚    â”‚
â”‚  â”‚  â”‚Samplingâ”‚  â”‚Relations      â”‚  â”‚              â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Step 2: Run Explainers (Parallel)                         â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚ GNNExplainer (Instance-level)                   â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ For each triple:                                â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   1. Optimize edge mask (gradient-based)        â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   2. Measure impact on prediction score         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   3. Extract top-k important edges              â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ Uses: âœ“ Encoder  âœ“ Decoder                      â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚ PGExplainer (Parameterized)                     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ 1. Train explainer network on edge sampling     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ 2. For each triple:                             â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    - Generate edge probabilities                â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    - Extract top-k edges                        â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ Uses: âœ“ Encoder  âœ“ Decoder                      â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚ Improved PAGE (Generative) â­                    â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ 1. Extract frozen CompGCN embeddings            â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚ CompGCN.encode(graph)            â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚   â†’ node_emb, rel_emb (frozen)   â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                â†“                                 â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ 2. For each triple:                             â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    a. Extract k-hop subgraph                    â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    b. Get subgraph features (CompGCN emb)       â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    c. Get prediction score                      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚       â”‚ score = CompGCN.decode(          â”‚      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚       â”‚   node_emb, rel_emb,             â”‚      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚       â”‚   head, tail, rel                â”‚      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚       â”‚ )                                 â”‚      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                â†“                                 â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ 3. Train Integrated VGAE:                       â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚ Input: CompGCN embeddings        â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚   â†“                               â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚ Encoder: MLP â†’ Latent Space       â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚   â†“                               â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚ Decoder: MLP â†’ Adjacency          â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚   â†“                               â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚ Loss = weighted_recon + KL        â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚ where:                            â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â”‚   weight = 1 + pred_w * Ïƒ(score) â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                â†“                                 â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ 4. Generate explanations                        â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    - Edge importance from reconstruction        â”‚     â”‚    â”‚
â”‚  â”‚  â”‚    - Extract top-k edges                        â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ Uses: âœ“ Encoder  âœ“ Decoder  âœ“ Pred-aware â­     â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Step 3: Compare & Summarize                               â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  - Compute overlap between explainers                     â”‚    â”‚
â”‚  â”‚  - Identify consensus edges                               â”‚    â”‚
â”‚  â”‚  - Generate summary statistics                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              EXPLANATIONS (05_model_explanations/)                  â”‚
â”‚                                                                     â”‚
â”‚  gnn_explanations.pkl      - GNNExplainer results                 â”‚
â”‚  pg_explanations.pkl       - PGExplainer results                  â”‚
â”‚  page_explanations.pkl     - Improved PAGE results â­              â”‚
â”‚  explanation_summary.pkl   - Comparison & overlap stats           â”‚
â”‚  selected_triples.pkl      - Triples that were explained          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” **Detailed: Improved PAGE Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  IMPROVED PAGE ARCHITECTURE                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INPUT: Trained CompGCN Model + Triple (h, r, t)
  â”‚
  â”œâ”€ Step 1: Extract Frozen Features
  â”‚   â”‚
  â”‚   â”œâ”€ CompGCN.encode(full_graph)
  â”‚   â”‚   â””â†’ node_embeddings [num_nodes Ã— embed_dim]
  â”‚   â”‚   â””â†’ rel_embeddings [num_rels Ã— embed_dim]
  â”‚   â”‚
  â”‚   â””â”€ Freeze parameters (no gradient)
  â”‚       for param in CompGCN.parameters():
  â”‚           param.requires_grad = False
  â”‚
  â”œâ”€ Step 2: For Each Triple to Explain
  â”‚   â”‚
  â”‚   â”œâ”€ Extract k-hop subgraph around (h, t)
  â”‚   â”‚   â”œâ”€ Find neighbors within k hops
  â”‚   â”‚   â”œâ”€ Extract subgraph edges
  â”‚   â”‚   â””â”€ Create adjacency matrix
  â”‚   â”‚
  â”‚   â”œâ”€ Get subgraph features
  â”‚   â”‚   features = node_embeddings[subgraph_nodes]
  â”‚   â”‚   â†’ [num_subgraph_nodes Ã— embed_dim]
  â”‚   â”‚
  â”‚   â””â”€ Get prediction score
  â”‚       score = CompGCN.decode(
  â”‚           node_embeddings[h],
  â”‚           node_embeddings[t],
  â”‚           rel_embeddings[r]
  â”‚       )
  â”‚       â†’ scalar score (higher = more confident)
  â”‚
  â”œâ”€ Step 3: Train Integrated VGAE
  â”‚   â”‚
  â”‚   â”œâ”€ INPUT: CompGCN features (not identity!)
  â”‚   â”‚   x = subgraph_features
  â”‚   â”‚   adj = adjacency_matrix
  â”‚   â”‚
  â”‚   â”œâ”€ ENCODER (Simpler than Simple PAGE)
  â”‚   â”‚   h = ReLU(Linear(x))        [embed_dim â†’ 32]
  â”‚   â”‚   mu = Linear(h)              [32 â†’ latent_dim]
  â”‚   â”‚   logvar = Linear(h)          [32 â†’ latent_dim]
  â”‚   â”‚
  â”‚   â”œâ”€ REPARAMETERIZE
  â”‚   â”‚   z = mu + Îµ * exp(0.5 * logvar)
  â”‚   â”‚   where Îµ ~ N(0, 1)
  â”‚   â”‚
  â”‚   â”œâ”€ DECODER
  â”‚   â”‚   h = ReLU(Linear(z))         [latent_dim â†’ 16]
  â”‚   â”‚   h = Sigmoid(Linear(h))      [16 â†’ 16]
  â”‚   â”‚   adj_recon = Sigmoid(h @ h^T)
  â”‚   â”‚
  â”‚   â””â”€ PREDICTION-AWARE LOSS â­
  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚       â”‚ Standard VGAE Loss:                    â”‚
  â”‚       â”‚   recon_loss = BCE(adj_recon, adj)     â”‚
  â”‚       â”‚   kl_loss = KL(N(mu, ÏƒÂ²) || N(0, 1))  â”‚
  â”‚       â”‚                                        â”‚
  â”‚       â”‚ Prediction-Aware Weighting:            â”‚
  â”‚       â”‚   weight = 1 + pred_w * Ïƒ(score)      â”‚
  â”‚       â”‚   weighted_recon = recon_loss * weight â”‚
  â”‚       â”‚                                        â”‚
  â”‚       â”‚ Total:                                 â”‚
  â”‚       â”‚   loss = weighted_recon + kl_w * kl    â”‚
  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚       Example with prediction_weight = 1.0:
  â”‚         score = -2.0 â†’ weight = 1.12 â†’ less focus
  â”‚         score =  3.0 â†’ weight = 1.95 â†’ more focus â­
  â”‚
  â””â”€ Step 4: Generate Explanation
      â”‚
      â”œâ”€ Encode to latent space (using mean)
      â”‚   mu, logvar = VGAE.encode(x, adj)
      â”‚   z = mu
      â”‚
      â”œâ”€ Decode to adjacency
      â”‚   adj_recon = VGAE.decode(z)
      â”‚
      â”œâ”€ Compute edge importance
      â”‚   importance = adj_recon * adj
      â”‚   â†’ Only score existing edges
      â”‚   â†’ Higher = more important for explaining prediction
      â”‚
      â””â”€ Extract top-k edges
          top_edges = argsort(importance, descending=True)[:k]

OUTPUT: Important edges that explain "Why did CompGCN predict this triple?"
```

---

## âš–ï¸ **Comparison: Simple vs Improved PAGE**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SIMPLE PAGE (OLD)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INPUT: Graph structure only
  â”‚
  â”œâ”€ Features: Identity matrix (one-hot)
  â”‚   x = torch.eye(num_nodes)
  â”‚   â†’ [num_nodes Ã— num_nodes]
  â”‚
  â”œâ”€ Encoder: 3-layer GCN
  â”‚   h1 = GCN(x, adj)           [num_nodes â†’ 32]
  â”‚   h2 = GCN(h1, adj)          [32 â†’ 16]
  â”‚   mu = GCN(h2, adj)          [16 â†’ latent]
  â”‚   logvar = GCN(h2, adj)      [16 â†’ latent]
  â”‚
  â”œâ”€ Loss: Standard VGAE
  â”‚   loss = recon_loss + kl_weight * kl_loss
  â”‚   âŒ No prediction awareness
  â”‚
  â””â”€ Explains: "These edges exist in the graph"
      âŒ Not faithful to CompGCN predictions

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 IMPROVED PAGE (NEW) â­                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INPUT: CompGCN embeddings + Prediction scores
  â”‚
  â”œâ”€ Features: CompGCN embeddings (frozen)
  â”‚   node_emb, rel_emb = CompGCN.encode(graph)
  â”‚   x = node_emb[subgraph_nodes]
  â”‚   â†’ [num_nodes Ã— embed_dim]
  â”‚   âœ“ Uses trained model knowledge
  â”‚
  â”œâ”€ Encoder: 1-layer MLP (simpler!)
  â”‚   h = ReLU(Linear(x))        [embed_dim â†’ 32]
  â”‚   mu = Linear(h)              [32 â†’ latent]
  â”‚   logvar = Linear(h)          [32 â†’ latent]
  â”‚   âœ“ Features already contextualized by CompGCN
  â”‚
  â”œâ”€ Loss: Prediction-aware VGAE â­
  â”‚   score = CompGCN.decode(h, t, r)
  â”‚   weight = 1 + pred_weight * sigmoid(score)
  â”‚   loss = (recon_loss * weight) + kl_weight * kl_loss
  â”‚   âœ“ Focuses on high-confidence predictions
  â”‚
  â””â”€ Explains: "Why did CompGCN predict this triple?"
      âœ“ Faithful to model predictions
```

---

## ğŸ“Š **Data Flow Summary**

```
TRAINING PHASE:
Raw Data â†’ PyG Data â†’ CompGCN Training â†’ Trained Model
   â†“           â†“             â†“                â†“
 TSV files   Tensors    Encoder+Decoder    .pkl file

EXPLANATION PHASE:
Trained Model â†’ Extract Embeddings â†’ Train VGAE â†’ Generate Explanations
      â†“               â†“                  â†“              â†“
 CompGCN.pth    node_emb, rel_emb   Integrated    Important edges
                (frozen)             VGAE          + scores
```

---

## ğŸ”‘ **Key Differences Highlighted**

| Component | Simple PAGE | Improved PAGE |
|-----------|-------------|---------------|
| **Input Features** | `torch.eye(num_nodes)` | `CompGCN.encode()` âœ“ |
| **Feature Dim** | `num_nodes` (large!) | `embed_dim` (small) |
| **Uses Encoder** | âœ— No | âœ“ Yes (frozen) |
| **Uses Decoder** | âœ— No | âœ“ Yes (for scores) |
| **Loss Weighting** | Uniform | By prediction score âœ“ |
| **Encoder Layers** | 3 GCN layers | 1 MLP layer |
| **Explains** | Graph structure | Model predictions âœ“ |
| **Fidelity** | Low (~0.3) | High (~0.8) âœ“ |

---

**See Also**:
- [IMPROVED_PAGE_IMPLEMENTATION.md](IMPROVED_PAGE_IMPLEMENTATION.md) - Detailed implementation
- [EXPLAINER_ARCHITECTURE_ANALYSIS.md](EXPLAINER_ARCHITECTURE_ANALYSIS.md) - Architecture analysis
- [COMPLETE_PIPELINE_OVERVIEW.md](COMPLETE_PIPELINE_OVERVIEW.md) - Complete reference
